セッションデータ（localStorage)
まずは、セッションをどう扱うか
・localStorage
・sessionStrage
・Cookie

・localStorage 　
メリット
→「純粋な JavaScript」という点が最高
バックエンド側の言語やロジックを一切使わずに、思う存分ブラウザ側にデータを保存できる
最大サイズが 4 KB に制限されている cookie に比べてサイズの制約がかなり緩く、主要なブラウザなら 5 MB を超えるデータ・ストレージを楽々利用できる

デメリット
→「string データしか保存できません」
同期的、local storage への操作は同時に 1 つしか実行できない
パフォーマンス向上のためにバックグラウンド処理や Chrome 拡張などを用いるアプリケーションを構築する場合、local storage はまったく利用できなくなる…web workers では使えないから
[* あらゆる JavaScript コードから自由にアクセスできてしまう]
→ 第三者の JavaScript コードが手違いで存在した場合にセキュリティリスクを大きく下げたければ、「local storage には決して秘密情報を保存しない」ことです。

使うべきシチュエーション
「秘密情報を一切含まないこと」「一般に入手可能な情報であること」「そこそこの量である（5 MB を超えない）こと」「string のみの情報であること」「保存するアプリケーションでパフォーマンスを要求されないこと」

重要なデータの保存
→ サーバーサイドセッションを使うべき

以下は重要なデータの例です

ユーザー ID
セッション ID
JWT
個人情報
クレジットカード情報
API キー
その他、Facebook で人目にさらしたくないような情報すべて

重要なデータを保存する必要が生じた場合は、以下のようにします。

・ユーザーが Web サイトにログインするときは、ユーザーのセッション ID を作成して、暗号化済み署名 cookie に保存します。Web フレームワークを使っている方は、フレームワークガイドの「cookie でユーザーセッションを作成する方法」あたりの情報に従いましょう。
Web フレームワークで使う cookie ライブラリは、種類を問わず[* httpOnly cookie フラグ]を必ず設定してください。このフラグを設定することで、ブラウザ側で（訳注: JavaScript を用いて）cookie を読み取ることは不可能になります。この設定は、cookie でサーバーサイドセッションを用いる場合の必須手順です。詳しくは勇敢なる Jeff Atwood の記事をご覧ください。

・使う cookie ライブラリでは、[* SameSite=strict cookie フラグ]（これはクロスサイトリクエストフォージェリ: CSRF 攻撃を防止します）と、[* secure=true フラグ]（cookie を暗号化済みコネクションでのみ設定できるようにします）も必ず設定してください

・ユーザーがサイトにリクエストを送信するたびに、[* 必ずセッション ID]（セッション ID はユーザーから送信された cookie から取り出します）を使ってアカウントの詳細情報をデータベースまたはキャッシュから取り出してください（どちらを使うかはサイトの規模によります）。

・ユーザーのアカウント情報を取り出して検証を終えたら、後はそこから関連する秘密情報を自由に取り出して利用します。

今後考えること
・CSP

「XSS の影響は Content Security Policy（CSP）で緩和できる」点への言及がないことが気になる方へ: 本記事ではあえて CSP に言及しないことにしています。理由は、本記事を理解するうえでの助けにならないからです。たとえ CSP を用いて第三者の JavaScript ドメインをすべてホワイトリスト化したところで、その第三者プロバイダそのものが乗っ取られてしまえば XSS を防ぎようがありません。

・JWT
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9.TJVA95OrM7E2cBab30RMHrHDcEfxjoYZgeFONFh7HgQ
→<ヘッダー>.<ペイロード>.<署名>
・yahoo tech ブログ JWT
https://techblog.yahoo.co.jp/advent-calendar-2017/jwt/
・JWT・Cookie それぞれの認証方式のメリデメ比較
https://qiita.com/doyaaaaaken/items/02357c2ebca994160804
・外部認証 API (JWT)　 Nuxt.js
https://ja.nuxtjs.org/examples/auth-external-jwt/
現在私が見たところ、セキュリティ上最大の脅威となるのは local storage に JWT（セッションデータ）を保存している人たちです。JWT がユーザー名とパスワードと本質的に同じであるという事実に、多くの人が気づいていません。

攻撃者が JWT をコピーすると、ユーザーがまったく気づかないうちに Web サイトへのリクエストをユーザーの代わりに実行できてしまいます。JWT はクレジットカードやパスワードと同じぐらい慎重に扱うものであり、間違っても local storage には保存してはいけません。

恐ろしいことに、「JWT は local storage に保存して認証メカニズムに使いましょう」という誤った知識を教えているチュートリアルや YouTube 動画やプログラミング教室や大学やブートキャンプが何千とあります。この情報は間違いです。こういうことを平気で教えるような場に居合わせたら、今すぐ逃げてください！

参考文献
・HTML5 の Local Storage を使ってはいけない（翻訳）
https://techracho.bpsinc.jp/hachi8833/2019_10_09/80851
